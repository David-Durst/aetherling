from aetherling.modules.reduce import DefineReduceSequential, DefineReduceParallelWithIdentity, renameCircuitForReduce
from aetherling.modules.register_any_type import DefineRegisterAnyType
from aetherling.modules.term_any_type import TermAnyType
from aetherling.modules.noop import DefineNoop
from magma.backend.coreir_ import CoreIRBackend
from magma.bitutils import *
from coreir.context import *
from magma.simulator.coreir_simulator import CoreIRSimulator
import coreir
from magma.scope import Scope
from mantle.coreir.arith import *
from mantle.coreir.logic import *
from mantle.coreir.compare import *
from mantle.coreir import DefineCoreirConst
from mantle.coreir.LUT import *
from aetherling.modules.upsample import *
from aetherling.modules.downsample import *
from aetherling.modules.reduce import *
from aetherling.modules.native_linebuffer.two_dimensional_native_linebuffer import DefineTwoDimensionalLineBuffer

args = ['I0', Array[8, In(Bit)], 'I1', Array[8, In(Bit)], 'I2', Array[8, In(Bit)], 'I3', Array[8, In(Bit)], 'I4', Array[8, In(Bit)], 'I5', Array[8, In(Bit)], 'I6', Array[8, In(Bit)], 'I7', Array[8, In(Bit)], 'O0', Array[8, Out(Bit)], 'valid_data_in', In(Bit), 'ready_data_in', Out(Bit), 'valid_data_out', Out(Bit), 'ready_data_out', In(Bit), ] + ClockInterface(has_ce=True)
downsample_256x256_to_32x32_8px_in_per_clk = DefineCircuit('downsample_256x256_to_32x32_8px_in_per_clk_Circuit', *args)
magmaInstance0 = DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 8, 1, 2, 2, 256, 256, 2, 2, 0, 0)()
magmaInstance1 = DefineNoop(DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 8, 1, 2, 2, 256, 256, 2, 2, 0, 0))()
magmaInstance2 = DefineCoreirConst(8, 1)()
magmaInstance3 = DefineCoreirConst(8, 1)()
magmaInstance4 = DefineCoreirConst(8, 2)()
magmaInstance5 = DefineCoreirConst(8, 2)()
magmaInstance7 = DefineCoreirConst(8, 3)()
magmaInstance8 = DefineCoreirConst(8, 3)()
magmaInstance9 = DefineCoreirConst(8, 4)()
magmaInstance10 = DefineCoreirConst(8, 4)()
wire(magmaInstance0.O[0][0][0], magmaInstance1.in_O[0][0][0])
wire(magmaInstance0.O[0][0][1], magmaInstance1.in_O[0][0][1])
wire(magmaInstance0.O[0][1][0], magmaInstance1.in_O[0][1][0])
wire(magmaInstance0.O[0][1][1], magmaInstance1.in_O[0][1][1])
wire(magmaInstance0.O[1][0][0], magmaInstance1.in_O[1][0][0])
wire(magmaInstance0.O[1][0][1], magmaInstance1.in_O[1][0][1])
wire(magmaInstance0.O[1][1][0], magmaInstance1.in_O[1][1][0])
wire(magmaInstance0.O[1][1][1], magmaInstance1.in_O[1][1][1])
magmaInstance14 = DefineCoreirMul(8)()
magmaInstance15 = DefineCoreirMul(8)()
magmaInstance16 = DefineCoreirMul(8)()
magmaInstance17 = DefineCoreirMul(8)()
magmaInstance18 = DefineCoreirMul(8)()
magmaInstance19 = DefineCoreirMul(8)()
magmaInstance20 = DefineCoreirMul(8)()
magmaInstance21 = DefineCoreirMul(8)()
wire(magmaInstance1.O[0][0][0], magmaInstance14.I0)
wire(magmaInstance2.O, magmaInstance14.I1)
wire(magmaInstance1.O[0][0][1], magmaInstance15.I0)
wire(magmaInstance4.O, magmaInstance15.I1)
wire(magmaInstance1.O[0][1][0], magmaInstance16.I0)
wire(magmaInstance7.O, magmaInstance16.I1)
wire(magmaInstance1.O[0][1][1], magmaInstance17.I0)
wire(magmaInstance9.O, magmaInstance17.I1)
wire(magmaInstance1.O[1][0][0], magmaInstance18.I0)
wire(magmaInstance3.O, magmaInstance18.I1)
wire(magmaInstance1.O[1][0][1], magmaInstance19.I0)
wire(magmaInstance5.O, magmaInstance19.I1)
wire(magmaInstance1.O[1][1][0], magmaInstance20.I0)
wire(magmaInstance8.O, magmaInstance20.I1)
wire(magmaInstance1.O[1][1][1], magmaInstance21.I0)
wire(magmaInstance10.O, magmaInstance21.I1)
magmaInstance22 = DefineReduceParallelWithIdentity(4, renameCircuitForReduce(DefineAdd(8)))()
magmaInstance23 = DefineReduceParallelWithIdentity(4, renameCircuitForReduce(DefineAdd(8)))()
magmaInstance22_identityGen = DefineCoreirConst(8, 0)()
wire(magmaInstance22_identityGen.O, magmaInstance22.I.identity)
wire(magmaInstance22_identityGen.O, magmaInstance23.I.identity)
wire(magmaInstance14.O, magmaInstance22.I.data[0])
wire(magmaInstance15.O, magmaInstance22.I.data[1])
wire(magmaInstance16.O, magmaInstance22.I.data[2])
wire(magmaInstance17.O, magmaInstance22.I.data[3])
wire(magmaInstance18.O, magmaInstance23.I.data[0])
wire(magmaInstance19.O, magmaInstance23.I.data[1])
wire(magmaInstance20.O, magmaInstance23.I.data[2])
wire(magmaInstance21.O, magmaInstance23.I.data[3])
magmaInstance24 = DefineNoop(DefineCoreirConst(8, 0))()
magmaInstance25 = DefineNoop(DefineCoreirConst(8, 0))()
magmaInstance26 = DefineCoreirConst(8, 4)()
magmaInstance27 = DefineCoreirConst(8, 4)()
wire(magmaInstance22.out, magmaInstance24.in_O)
wire(magmaInstance23.out, magmaInstance25.in_O)
magmaInstance29 = DefineCoreirUDiv(8)()
magmaInstance30 = DefineCoreirUDiv(8)()
wire(magmaInstance24.O, magmaInstance29.I0)
wire(magmaInstance26.O, magmaInstance29.I1)
wire(magmaInstance25.O, magmaInstance30.I0)
wire(magmaInstance27.O, magmaInstance30.I1)
magmaInstance31 = DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 2, 1, 2, 2, 128, 128, 2, 2, 0, 0)()
wire(magmaInstance29.O, magmaInstance31.I[0][0])
wire(magmaInstance30.O, magmaInstance31.I[0][1])
magmaInstance32 = DefineNoop(DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 2, 1, 2, 2, 128, 128, 2, 2, 0, 0))()
magmaInstance33 = DefineCoreirConst(8, 1)()
magmaInstance34 = DefineCoreirConst(8, 2)()
magmaInstance35 = DefineCoreirConst(8, 3)()
magmaInstance36 = DefineCoreirConst(8, 4)()
wire(magmaInstance31.O[0][0][0], magmaInstance32.in_O[0][0][0])
wire(magmaInstance31.O[0][0][1], magmaInstance32.in_O[0][0][1])
wire(magmaInstance31.O[0][1][0], magmaInstance32.in_O[0][1][0])
wire(magmaInstance31.O[0][1][1], magmaInstance32.in_O[0][1][1])
magmaInstance37 = DefineCoreirMul(8)()
magmaInstance38 = DefineCoreirMul(8)()
magmaInstance39 = DefineCoreirMul(8)()
magmaInstance40 = DefineCoreirMul(8)()
wire(magmaInstance32.O[0][0][0], magmaInstance37.I0)
wire(magmaInstance33.O, magmaInstance37.I1)
wire(magmaInstance32.O[0][0][1], magmaInstance38.I0)
wire(magmaInstance34.O, magmaInstance38.I1)
wire(magmaInstance32.O[0][1][0], magmaInstance39.I0)
wire(magmaInstance35.O, magmaInstance39.I1)
wire(magmaInstance32.O[0][1][1], magmaInstance40.I0)
wire(magmaInstance36.O, magmaInstance40.I1)
magmaInstance41 = DefineReduceParallelWithIdentity(4, renameCircuitForReduce(DefineAdd(8)))()
magmaInstance41_identityGen = DefineCoreirConst(8, 0)()
wire(magmaInstance41_identityGen.O, magmaInstance41.I.identity)
wire(magmaInstance37.O, magmaInstance41.I.data[0])
wire(magmaInstance38.O, magmaInstance41.I.data[1])
wire(magmaInstance39.O, magmaInstance41.I.data[2])
wire(magmaInstance40.O, magmaInstance41.I.data[3])
magmaInstance42 = DefineNoop(DefineCoreirConst(8, 0))()
magmaInstance43 = DefineCoreirConst(8, 4)()
wire(magmaInstance41.out, magmaInstance42.in_O)
magmaInstance44 = DefineCoreirUDiv(8)()
wire(magmaInstance42.O, magmaInstance44.I0)
wire(magmaInstance43.O, magmaInstance44.I1)
magmaInstance45 = DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 1, 1, 2, 2, 64, 64, 2, 2, 0, 0)()
wire(magmaInstance44.O, magmaInstance45.I[0][0])
magmaInstance46 = DefineNoop(DefineTwoDimensionalLineBuffer(Array[8, In(Bit)], 1, 1, 2, 2, 64, 64, 2, 2, 0, 0))()
magmaInstance47 = DefineCoreirConst(8, 1)()
magmaInstance48 = DefineCoreirConst(8, 2)()
magmaInstance49 = DefineCoreirConst(8, 3)()
magmaInstance50 = DefineCoreirConst(8, 4)()
wire(magmaInstance45.O[0][0][0], magmaInstance46.in_O[0][0][0])
wire(magmaInstance45.O[0][0][1], magmaInstance46.in_O[0][0][1])
wire(magmaInstance45.O[0][1][0], magmaInstance46.in_O[0][1][0])
wire(magmaInstance45.O[0][1][1], magmaInstance46.in_O[0][1][1])
magmaInstance51 = DefineCoreirMul(8)()
magmaInstance52 = DefineCoreirMul(8)()
magmaInstance53 = DefineCoreirMul(8)()
magmaInstance54 = DefineCoreirMul(8)()
wire(magmaInstance46.O[0][0][0], magmaInstance51.I0)
wire(magmaInstance47.O, magmaInstance51.I1)
wire(magmaInstance46.O[0][0][1], magmaInstance52.I0)
wire(magmaInstance48.O, magmaInstance52.I1)
wire(magmaInstance46.O[0][1][0], magmaInstance53.I0)
wire(magmaInstance49.O, magmaInstance53.I1)
wire(magmaInstance46.O[0][1][1], magmaInstance54.I0)
wire(magmaInstance50.O, magmaInstance54.I1)
magmaInstance55 = DefineReduceParallelWithIdentity(4, renameCircuitForReduce(DefineAdd(8)))()
magmaInstance55_identityGen = DefineCoreirConst(8, 0)()
wire(magmaInstance55_identityGen.O, magmaInstance55.I.identity)
wire(magmaInstance51.O, magmaInstance55.I.data[0])
wire(magmaInstance52.O, magmaInstance55.I.data[1])
wire(magmaInstance53.O, magmaInstance55.I.data[2])
wire(magmaInstance54.O, magmaInstance55.I.data[3])
magmaInstance56 = DefineNoop(DefineCoreirConst(8, 0))()
magmaInstance57 = DefineCoreirConst(8, 4)()
wire(magmaInstance55.out, magmaInstance56.in_O)
magmaInstance58 = DefineCoreirUDiv(8)()
wire(magmaInstance56.O, magmaInstance58.I0)
wire(magmaInstance57.O, magmaInstance58.I1)
wire(downsample_256x256_to_32x32_8px_in_per_clk.I0, magmaInstance0.I[0][0])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I1, magmaInstance0.I[0][1])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I2, magmaInstance0.I[0][2])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I3, magmaInstance0.I[0][3])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I4, magmaInstance0.I[0][4])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I5, magmaInstance0.I[0][5])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I6, magmaInstance0.I[0][6])
wire(downsample_256x256_to_32x32_8px_in_per_clk.I7, magmaInstance0.I[0][7])
wire(downsample_256x256_to_32x32_8px_in_per_clk.O0, magmaInstance58.O)
wire(magmaInstance0.ready, downsample_256x256_to_32x32_8px_in_per_clk.ready_data_in)
wire(magmaInstance45.valid, downsample_256x256_to_32x32_8px_in_per_clk.valid_data_out)
wire(downsample_256x256_to_32x32_8px_in_per_clk.valid_data_in & magmaInstance31.ready & bit(downsample_256x256_to_32x32_8px_in_per_clk.CE), magmaInstance0.CE)
wire(magmaInstance0.valid & magmaInstance45.ready & bit(downsample_256x256_to_32x32_8px_in_per_clk.CE), magmaInstance31.CE)
wire(magmaInstance31.valid & downsample_256x256_to_32x32_8px_in_per_clk.ready_data_out & bit(downsample_256x256_to_32x32_8px_in_per_clk.CE), magmaInstance45.CE)
ceTerm = TermAnyType(Enable)
wire(ceTerm.I, downsample_256x256_to_32x32_8px_in_per_clk.CE)
EndCircuit()
